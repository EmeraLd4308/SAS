name: Simple Connection Test
on: workflow_dispatch

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Install PostgreSQL
        run: sudo apt-get install -y postgresql-client

      - name: Test Connection
        env:
          DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
        run: |
          echo "🔧 Тестую з'єднання..."
          
          # Спробуємо з curl (без пароля)
          echo "1. Чи відповідає сервер?"
          curl -s https://rhrcqedkxmxzedeowiwx.supabase.co/rest/v1/ || echo "❌ REST API не відповідає"
          
          # Спробуємо підключитись
          echo "2. Підключення до бази..."
          timeout 5 psql \
            "postgresql://postgres:${DB_PASSWORD}@db.rhrcqedkxmxzedeowiwx.supabase.co:5432/postgres?sslmode=require" \
            -c "SELECT '✅ Connected!' as status;" 2>&1 || echo "❌ Не вдалося підключитись"
          
          echo "Тест завершено"